<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - PIBID UFAL</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

    <style>
        /* --- MANTENHA O MESMO CSS DE ANTES (Resumido aqui para n√£o ficar gigante) --- */
        :root {
            --azul-escuro: #0f172a; --azul-principal: #1e40af; --azul-claro: #3b82f6; 
            --azul-fundo: #eff6ff; --branco: #ffffff; --cinza-texto: #333333;
            --verde-sucesso: #10b981; --vermelho-erro: #ef4444; --amarelo-alerta: #f59e0b; 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--azul-fundo); color: var(--cinza-texto); }
        
        /* Apenas adicione/garanta este estilo para o modal de config */
        .form-config { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0; }
        .form-config input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; width: 100%; }
        .btn-save-config { background: var(--azul-principal); color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-save-config:hover { background: var(--azul-claro); }
        .btn-save-config:disabled { background: #ccc; cursor: not-allowed; }

        /* --- RESTO DO CSS IGUAL AO ANTERIOR --- */
        @media print {
    /* Esconde tudo do painel */
    body * { visibility: hidden; }
    
    /* Mostra apenas a √°rea de impress√£o */
    #area-impressao, #area-impressao * { visibility: visible; }
    
    #area-impressao {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        display: block !important;
        background: white;
    }

    /* Estiliza√ß√£o da Tabela no Papel */
    .relatorio-oficial { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .relatorio-oficial th, .relatorio-oficial td { 
        border: 1px solid #000; 
        padding: 8px; 
        font-size: 11px; 
        text-align: left; 
    }
    .relatorio-oficial th { background-color: #eee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    /* Cabe√ßalho com Logos */
    .print-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    .print-header img { height: 60px; width: auto; }
}
        #login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(-45deg, #0f172a, #1e40af, #002b5c, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; 
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .login-card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            padding: 50px 40px; 
            border-radius: 20px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center; width: 90%; max-width: 400px; 
            animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            color: white;
        }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .input-group label { display: block; margin-bottom: 8px; color: rgba(255,255,255,0.9); font-weight: 500; font-size: 0.9rem; text-align: left; }
        
        .login-card input[type="text"], .login-card input[type="email"], .password-wrapper input { 
            width: 100%; padding: 15px; 
            background: rgba(255, 255, 255, 0.05); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 12px; font-size: 1rem; color: white; outline: none; transition: 0.3s; 
        } 
        .login-card input::placeholder { color: rgba(255,255,255,0.4); }
        .login-card input:focus { border-color: var(--azul-claro); background: rgba(255, 255, 255, 0.1); box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
        
        .btn-login { 
            width: 100%; padding: 15px; 
            background: linear-gradient(135deg, var(--azul-principal), var(--azul-claro)); 
            color: white; border: none; border-radius: 12px; 
            font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.3s; margin-top: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        } 
        .btn-login:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4); } 
        .btn-login:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .eye-icon { color: rgba(255,255,255,0.6); } .eye-icon:hover { color: white; }
        header { background-color: var(--branco); padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px; border-bottom: 3px solid var(--azul-principal); position: relative; }
        .logo-area { display: flex; align-items: center; gap: 20px; } .header-logo { height: 60px; width: auto; object-fit: contain; }
        .site-title { border-left: 2px solid #ccc; padding-left: 20px; } .site-title h1 { color: var(--azul-principal); font-size: 1.4rem; text-transform: uppercase; line-height: 1.1; margin: 0; } .site-title p { margin: 0; font-size: 0.8rem; color: #666; font-weight: 600; }
        .user-container { position: relative; cursor: pointer; display: flex; align-items: center; gap: 10px; padding: 5px 15px; border-radius: 8px; transition: 0.2s; } .user-container:hover { background-color: var(--azul-fundo); }
        .user-info { text-align: right; } .user-name { color: var(--azul-principal); font-weight: bold; display: block; font-size: 0.95rem; } .user-role { font-size: 0.75rem; color: #666; } .user-avatar { width: 40px; height: 40px; background: var(--azul-principal); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .dropdown-menu { position: absolute; top: 100%; right: 0; margin-top: 10px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); width: 220px; display: none; overflow: hidden; border: 1px solid #eee; animation: fadeIn 0.2s ease; z-index: 1000; } .dropdown-menu.show { display: block; }
        .dropdown-item { padding: 12px 20px; display: flex; align-items: center; gap: 10px; color: #555; text-decoration: none; transition: 0.2s; cursor: pointer; font-size: 0.9rem; } .dropdown-item:hover { background-color: var(--azul-fundo); color: var(--azul-principal); } .dropdown-item.danger { color: var(--vermelho-erro); border-top: 1px solid #eee; } .dropdown-item.danger:hover { background-color: #fff1f2; }
        .btn-home { background: white; color: var(--azul-principal); border: 2px solid var(--azul-principal); padding: 8px 20px; border-radius: 30px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; text-decoration: none; margin-right: 10px; } .btn-home:hover { background: var(--azul-principal); color: white; }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 5%; }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid var(--azul-claro); } .stat-card.azul { border-color: var(--azul-principal); } .stat-card.verde { border-color: var(--verde-sucesso); } .stat-card.amarelo { border-color: var(--amarelo-alerta); } .stat-card h3 { font-size: 0.9rem; color: #666; text-transform: uppercase; letter-spacing: 1px; } .stat-card p { font-size: 2.5rem; font-weight: 700; color: var(--azul-escuro); margin-top: 10px; }
        .filtros-bar { display: flex; flex-direction: row; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 30px; overflow-x: auto; padding-bottom: 5px; }
        .filtros-group { display: flex; gap: 10px; background: white; padding: 8px; border-radius: 50px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); flex-wrap: wrap; }
        .btn-filtro { padding: 8px 20px; border: none; background: transparent; border-radius: 40px; cursor: pointer; font-weight: 500; color: #666; transition: 0.2s; display: flex; align-items: center; gap: 5px; } .btn-filtro:hover { background: var(--azul-fundo); color: var(--azul-principal); } .btn-filtro.ativo { background: var(--azul-principal); color: white; }
        
        /* NOVA CLASSE PARA ABAS SUPERIORES */
        .btn-modulo { padding: 12px 25px; border: none; background: transparent; border-radius: 10px; cursor: pointer; font-weight: 700; color: #555; transition: 0.2s; display: flex; align-items: center; gap: 8px; font-size: 1.05rem; }
        .btn-modulo:hover { background: #e2e8f0; color: var(--azul-principal); }
        .btn-modulo.ativo { background: var(--azul-principal); color: white; box-shadow: 0 4px 10px rgba(30, 64, 175, 0.3); }

        .action-buttons { display: flex; gap: 10px; flex-wrap: nowrap; align-items: center; }
        .btn-padrao, .btn-trash-view, .btn-report, .btn-logs { padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 700; transition: 0.2s; white-space: nowrap; height: 45px; }
    
        .btn-padrao { background: white; border: 2px solid var(--azul-principal); color: var(--azul-principal); } .btn-padrao:hover { background: var(--azul-principal); color: white; }
        .btn-trash-view { background: white; border: 2px solid var(--vermelho-erro); color: var(--vermelho-erro); } .btn-trash-view:hover, .btn-trash-view.ativo { background: var(--vermelho-erro); color: white; }
        .btn-report { background: var(--azul-escuro); border: 2px solid var(--azul-escuro); color: white; } .btn-report:hover { background: #334155; border-color: #334155; }
        .btn-logs { background: #f59e0b; border: 2px solid #f59e0b; color: white; } .btn-logs:hover { background: #d97706; border-color: #d97706; }
        @media (max-width: 900px) { .filtros-bar { flex-direction: column; align-items: stretch; } .filtros-group { justify-content: center; } .action-buttons { flex-wrap: wrap; justify-content: center; } .action-buttons button { flex: 1; min-width: 140px; justify-content: center; } header { flex-direction: column; gap: 15px; } .btn-home { margin-right: 0; width: 100%; justify-content: center; } }
        .grid-inscritos { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; }
        .card-pessoa { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #eee; border-left: 5px solid #ccc; position: relative; display: flex; flex-direction: column; }
        .tipo-Apresentador { border-left-color: var(--azul-principal); } .tipo-Ouvinte { border-left-color: var(--verde-sucesso); } .tipo-Monitor { border-left-color: var(--amarelo-alerta); } .card-pessoa.na-lixeira { border-left-color: var(--vermelho-erro); opacity: 0.8; background-color: #fff5f5; }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 15px; } .protocolo { font-family: monospace; background: var(--azul-fundo); color: var(--azul-principal); padding: 4px 8px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; } .card-tag { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; padding: 4px 10px; border-radius: 4px; } .tag-Apresentador { background: #e0e7ff; color: var(--azul-principal); } .tag-Ouvinte { background: #d1fae5; color: var(--verde-sucesso); } .tag-Monitor { background: #fef3c7; color: #b45309; }
        .card-body h3 { font-size: 1.2rem; color: var(--azul-escuro); margin-bottom: 15px; font-weight: 700; } .info-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 0.9rem; color: #555; } .info-row span.icon { font-size: 1.1rem; color: var(--azul-claro); min-width: 24px; text-align: center; } .card-footer { margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { font-size: 0.85rem; font-weight: 600; padding: 5px 10px; border-radius: 6px; display: flex; align-items: center; gap: 5px; } .status-pendente { background: #fff7ed; color: var(--amarelo-alerta); border: 1px solid #ffedd5; } .status-ok { background: #f0fdf4; color: var(--verde-sucesso); border: 1px solid #dcfce7; } .status-lixeira { background: #fee2e2; color: var(--vermelho-erro); border: 1px solid #fecaca; }
        .btn-icon { width: 38px; height: 38px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; margin-left: 5px; } .btn-confirm { background: var(--verde-sucesso); color: white; } .btn-view { background: var(--azul-claro); color: white; } .btn-delete { background: white; border: 1px solid var(--vermelho-erro); color: var(--vermelho-erro); } .btn-restore { background: var(--verde-sucesso); color: white; } .btn-forever { background: var(--vermelho-erro); color: white; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(5px); z-index: 10000; display: none; justify-content: center; align-items: center; } .modal-content { background: white; width: 90%; max-width: 600px; border-radius: 15px; padding: 30px; position: relative; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); max-height: 90vh; overflow-y: auto; } .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; color: #999; }
        .report-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; } .btn-report-opt { padding: 20px; border: 2px solid #eee; border-radius: 10px; background: white; cursor: pointer; text-align: center; transition: 0.2s; } .btn-report-opt:hover { border-color: var(--azul-principal); background: var(--azul-fundo); } .btn-report-opt span { display: block; font-size: 2rem; margin-bottom: 10px; color: var(--azul-principal); } .btn-report-opt strong { display: block; color: var(--azul-escuro); }
        .modal-confirm-content { text-align: center; max-width: 400px; } .modal-confirm-icon { font-size: 60px; color: var(--amarelo-alerta); margin-bottom: 15px; } .modal-confirm-title { font-size: 1.5rem; color: var(--azul-escuro); margin-bottom: 10px; font-weight: 700; } .modal-confirm-actions { display: flex; gap: 10px; justify-content: center; margin-top: 25px; } .btn-modal-cancel { padding: 10px 20px; background: #e2e8f0; color: #64748b; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; } .btn-modal-confirm { padding: 10px 20px; background: var(--azul-principal); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; } .btn-modal-confirm.danger { background: var(--vermelho-erro); }
        .table-logs { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; } .table-logs th { background: var(--azul-fundo); color: var(--azul-principal); padding: 10px; text-align: left; } .table-logs td { border-bottom: 1px solid #eee; padding: 10px; color: #555; } .table-logs tr:last-child td { border-bottom: none; }
        #area-impressao { display: none; }
        /* Galeria e Input File */
        .upload-area { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 40px; text-align: center; background-color: #f8fafc; transition: 0.3s; margin-bottom: 30px; } .upload-area:hover { border-color: var(--azul-principal); background-color: #eff6ff; }
        .grid-galeria { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card-foto { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.2s; position: relative; } .card-foto:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .foto-img-container { width: 100%; height: 200px; overflow: hidden; background: #eee; } .foto-img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .card-foto-body { padding: 15px; display: flex; flex-direction: column; gap: 8px; } .card-foto-date { font-size: 0.75rem; color: #999; }
        .btn-delete-foto { position: absolute; top: 10px; right: 10px; background: rgba(239, 68, 68, 0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .input-file-trigger { background: var(--azul-principal); color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: inline-block; margin-top: 10px; font-weight: 600; } .input-file-hidden { display: none; }
    </style>
</head>
<body>

    <div id="modal-detalhes" class="modal-overlay">
        <div class="modal-content">
            <span class="material-symbols-rounded close-modal" onclick="fecharModal('modal-detalhes')">close</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="modal-config" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <span class="material-symbols-rounded close-modal" onclick="fecharModal('modal-config')">close</span>
            <h2 style="color: var(--azul-escuro); margin-bottom: 5px;">Adicionar Novo Administrador</h2>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Crie um novo acesso para o painel.</p>
            
            <div class="form-config">
                <div>
                    <label>E-mail do Novo Admin</label>
                    <input type="email" id="new-admin-email" placeholder="ex: professor@pibid.com">
                </div>
                <div>
                    <label>Senha de Acesso</label>
                    <input type="text" id="new-admin-pass" placeholder="M√≠nimo 6 caracteres">
                </div>
                <p id="msg-config" style="font-size: 0.85rem; margin-top: 5px; display: none;"></p>
                <button class="btn-save-config" id="btn-save-admin" onclick="salvarAdmin()">CRIAR ADMINISTRADOR</button>
            </div>
            
            <div style="background: #e0f2fe; color: #0284c7; padding: 15px; border-radius: 8px; font-size: 0.85rem; border: 1px solid #bae6fd;">
                <strong>Nota:</strong> Este usu√°rio ter√° acesso total ao painel imediatamente.
            </div>
        </div>
    </div>

    <div id="modal-logs" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <span class="material-symbols-rounded close-modal" onclick="fecharModal('modal-logs')">close</span>
            <h2 style="color: var(--azul-escuro); margin-bottom: 5px;">Hist√≥rico de Atividades</h2>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Registro de altera√ß√µes feitas por administradores.</p>
            <div style="overflow-x: auto; max-height: 400px;">
                <table class="table-logs">
                    <thead><tr><th>Data/Hora</th><th>Admin</th><th>A√ß√£o</th><th>ID do Alvo</th></tr></thead>
                    <tbody id="tbody-logs"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal-confirmacao" class="modal-overlay">
        <div class="modal-content modal-confirm-content">
            <span class="material-symbols-rounded modal-confirm-icon" id="confirm-icon">help</span>
            <div class="modal-confirm-title" id="confirm-title">Tem certeza?</div>
            <p id="confirm-text" style="color: #666;">Essa a√ß√£o n√£o pode ser desfeita.</p>
            <div class="modal-confirm-actions">
                <button class="btn-modal-cancel" onclick="fecharModal('modal-confirmacao')">Cancelar</button>
                <button class="btn-modal-confirm" id="btn-confirm-action" onclick="executarAcaoConfirmada()">Sim, Confirmar</button>
            </div>
        </div>
    </div>

    <div id="modal-relatorios" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <span class="material-symbols-rounded close-modal" onclick="fecharModal('modal-relatorios')">close</span>
            <h2 style="color: var(--azul-escuro); text-align: center;">Gerar Relat√≥rio</h2>
            <div class="report-options">
                <button class="btn-report-opt" onclick="gerarRelatorio('lista_presenca')">
                    <span class="material-symbols-rounded">checklist</span><strong>Lista de Presen√ßa</strong>
                </button>
                <button class="btn-report-opt" onclick="gerarRelatorio('lista_apresentadores')">
                    <span class="material-symbols-rounded">co_present</span><strong>Apresentadores</strong>
                </button>
                <button class="btn-report-opt" onclick="gerarRelatorio('lista_emails')">
                    <span class="material-symbols-rounded">alternate_email</span><strong>Lista de E-mails</strong>
                </button>
            </div>
        </div>
    </div>

    <div id="modal-aviso" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <span class="material-symbols-rounded" id="aviso-icon" style="font-size: 60px; margin-bottom: 15px;">info</span>
            <h2 id="aviso-titulo" style="color: var(--azul-escuro); margin-bottom: 10px;">Aviso</h2>
            <p id="aviso-msg" style="color: #666; margin-bottom: 25px;">Mensagem...</p>
            <button class="btn-login" onclick="fecharModal('modal-aviso')" style="width: 100%;">ENTENDI</button>
        </div>
    </div>

    <div id="login-overlay">
        <div class="login-card">
            <div style="margin-bottom: 20px;">
                <span class="material-symbols-rounded" style="font-size: 60px; color: var(--azul-claro); text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);">admin_panel_settings</span>
            </div>
            <h2 style="font-size: 1.8rem; margin-bottom: 5px;">P√°gina do Monitor</h2>
            <p style="margin-bottom: 30px; font-size: 0.95rem; color: rgba(255,255,255,0.7);">Acesso √† gest√£o da feira</p>
            <div class="input-group">
                <label for="usuario-admin">E-mail de Acesso</label>
                <input type="email" id="usuario-admin" placeholder="admin@exemplo.com">
            </div>
            <div class="input-group">
                <label for="senha-admin">Senha</label>
                <div class="password-wrapper">
                    <input type="password" id="senha-admin" placeholder="Digite sua senha">
                    <span class="material-symbols-rounded eye-icon" onclick="alternarVisibilidadeSenha()" id="icone-olho">visibility</span>
                </div>
            </div>
            <button class="btn-login" id="btn-login" onclick="fazerLogin()">ENTRAR NO SISTEMA</button>
            <p id="msg-erro" style="color: var(--vermelho-erro); margin-top: 15px; display: none; font-weight: 600;">Usu√°rio ou senha incorretos!</p>
        </div>
    </div>

    <div id="painel-conteudo" style="display: none;">
        <header>
            <div class="logo-area">
                <img src="ufal.webp" alt="UFAL" class="header-logo">   
                <img src="brasaoteotoniovilela.png" alt="Logo PIBID" class="header-logo">   
                <img src="pibid.webp" alt="Bras√£o Teot√¥nio Vilela" class="header-logo">  
                <div class="site-title">
                <h1>P√ÅGINA DO MONITOR</h1>
                <p>Gest√£o do Evento - PIBID</p>
            </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                
                <a href="index.html" class="btn-home">
                    <span class="material-symbols-rounded">home</span> Ir para o Site
                </a>

                <div style="position: relative;">
                    <div class="user-container" onclick="abrirMenuUsuario()">
                        <div class="user-info">
                            <span class="user-name" id="display-nome-user">Admin</span>
                            <span class="user-role">Administrador</span>
                        </div>
                        <div class="user-avatar">
                            <span class="material-symbols-rounded">person</span>
                        </div>
                        <span class="material-symbols-rounded" style="color:#666; font-size:1.2rem;">expand_more</span>
                    </div>
                    
                    <div id="dropdown-menu" class="dropdown-menu">
                        <div class="dropdown-item" onclick="abrirModalConfig()">
                            <span class="material-symbols-rounded">settings</span> Criar Novo Admin
                        </div>
                        <div class="dropdown-item danger" onclick="fazerLogout()">
                            <span class="material-symbols-rounded">logout</span> Sair
                        </div>
                    </div>
                </div>

            </div>
        </header>

        <div class="container">
            <div style="margin-bottom: 30px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; display: flex; gap: 20px;">
                <button class="btn-modulo ativo" id="tab-inscritos" onclick="alternarAba('inscritos')">
                    <span class="material-symbols-rounded">groups</span> Gest√£o de Inscritos
                </button>
                <button class="btn-modulo" id="tab-galeria" onclick="alternarAba('galeria')">
                    <span class="material-symbols-rounded">perm_media</span> Galeria de Fotos
                </button>
                <button class="btn-modulo" id="tab-calendario" onclick="alternarAba('calendario')">
                    <span class="material-symbols-rounded">calendar_month</span> Calend√°rio
                </button>
                <button class="btn-modulo" id="tab-vencedor" onclick="alternarAba('vencedor')">
                    <span class="material-symbols-rounded">emoji_events</span> Resultados Finais
                </button>
            </div>

            <div id="view-inscritos">
                <div class="stats-container">
                    <div class="stat-card azul"><h3>Total Geral</h3><p id="total-geral">0</p></div>
                    <div class="stat-card azul"><h3>Apresentadores</h3><p id="total-apresentadores">0</p></div>
                    <div class="stat-card verde"><h3>Ouvintes</h3><p id="total-ouvintes">0</p></div>
                    <div class="stat-card amarelo"><h3>Monitores</h3><p id="total-monitores">0</p></div>
                </div>

                <div class="filtros-bar">
                    <div class="filtros-group">
                        <button class="btn-filtro ativo" onclick="filtrar('todos', this)">Todos</button>
                        <button class="btn-filtro" onclick="filtrar('confirmados', this)"><span class="material-symbols-rounded" style="font-size:18px; color:var(--verde-sucesso);">check_circle</span> Confirmados</button>
                        <button class="btn-filtro" onclick="filtrar('Apresentador', this)">Apresentadores</button>
                        <button class="btn-filtro" onclick="filtrar('Ouvinte', this)">Ouvintes</button>
                        <button class="btn-filtro" onclick="filtrar('Monitor', this)">Monitores</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-logs" onclick="abrirModalLogs()"><span class="material-symbols-rounded">history</span> Hist√≥rico</button>
                        <button class="btn-report" onclick="abrirModalRelatorios()"><span class="material-symbols-rounded">print</span> Relat√≥rios</button>
                        <button class="btn-trash-view" id="btn-trash" onclick="alternarModoLixeira()"><span class="material-symbols-rounded">delete</span> Ver Lixeira</button>
                        <button class="btn-padrao" onclick="carregarDados()"><span class="material-symbols-rounded">sync</span> Atualizar</button>
                    </div>
                </div>

                <h3 id="titulo-grid" style="margin-bottom: 20px; color: var(--azul-principal); display: none;">üóëÔ∏è ITENS NA LIXEIRA</h3>
                <div id="loader" style="text-align: center; padding: 40px; display: none;">
                    <span class="material-symbols-rounded" style="font-size: 40px; color: var(--azul-claro); animation: spin 1s linear infinite;">progress_activity</span>
                </div>
                <div id="grid-cards" class="grid-inscritos"></div>
            </div>

            <div id="view-galeria" style="display: none;">
                <div class="upload-area">
                    <span class="material-symbols-rounded" style="font-size: 48px; color: var(--azul-claro);">cloud_upload</span>
                    <h3 style="color: var(--azul-escuro); margin-top: 10px;">Adicionar Nova Foto</h3>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">Formatos aceitos: JPG, PNG, WEBP</p>
                    <div style="max-width: 400px; margin: 0 auto; display: flex; flex-direction: column; gap: 10px;">
                        <input type="text" id="foto-titulo" placeholder="Legenda base das fotos" style="padding: 10px; border: 1px solid #ccc; border-radius: 8px;">
                        <label for="input-foto" class="input-file-trigger">Selecionar Arquivo(s)</label>
                        <input type="file" id="input-foto" class="input-file-hidden" accept="image/*" onchange="mostrarNomeArquivo()" multiple >
                        <p id="nome-arquivo-selecionado" style="font-size: 0.8rem; color: var(--azul-principal); font-weight: bold;"></p>
                        <button id="btn-upload" class="btn-login" style="margin-top: 0;" onclick="fazerUploadFoto()">ENVIAR FOTO(S)</button>
                        <div id="progresso-upload" style="display:none; color: var(--azul-principal); font-weight: bold; margin-top: 10px;">Enviando...</div>
                    </div>
                </div>
                <h3 style="color: var(--azul-escuro); margin-bottom: 20px; border-left: 4px solid var(--azul-principal); padding-left: 10px;">Fotos na Galeria</h3>
                
                <div id="bulk-toolbar" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: 600; color: var(--azul-escuro);">
                        <input type="checkbox" id="chk-todos" onchange="selecionarTodas(this)" style="width: 18px; height: 18px;">
                        Selecionar Todas
                    </label>
                    <button id="btn-bulk-delete" class="btn-trash-view" onclick="solicitarExclusaoEmMassa()" style="padding: 5px 15px; font-size: 0.9rem; display: none;">
                        <span class="material-symbols-rounded">delete</span> Excluir (<span id="count-sel">0</span>)
                    </button>
                </div>

                <div id="loader-galeria" style="text-align: center; padding: 20px; display: none;">Carregando fotos...</div>
                <div id="grid-galeria" class="grid-galeria"></div>
            </div>

            <!-- VIEW CALENDARIO -->
            <div id="view-calendario" style="display: none;">
                <div class="stats-container">
                    <div class="stat-card azul"><h3>Eventos Cadastrados</h3><p id="total-eventos">0</p></div>
                </div>
                <div class="form-config">
                    <h3>Adicionar Evento ao Calend√°rio</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="date" id="evt-data" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ccc;">
                        <input type="text" id="evt-desc" placeholder="Descri√ß√£o do Evento (Ex: Abertura)" style="flex: 3; padding: 10px; border-radius: 8px; border: 1px solid #ccc;">
                        <button class="btn-padrao" onclick="salvarEvento()" style="border: none; background: var(--azul-principal); color: white;">Salvar Evento</button>
                    </div>
                </div>
                <h3>Pr√≥ximos Eventos</h3>
                <div id="lista-eventos" style="margin-top: 20px; display: grid; gap: 10px;"></div>
            </div>

            <!-- VIEW VENCEDOR (Refactored for Multiple Years) -->
            <div id="view-vencedor" style="display: none;">
                <h3 style="color: var(--azul-escuro); margin-bottom: 20px;">Gerenciar Galeria de Vencedores</h3>
                
                <div class="form-config" style="background: white; border-top: 5px solid var(--amarelo-alerta);">
                    <h4 style="margin-bottom: 15px; color: #555;">Adicionar Novo Vencedor</h4>
                    <div style="display: grid; grid-template-columns: 100px 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 0.85rem; font-weight: bold;">Ano</label>
                            <input type="number" id="win-ano" placeholder="2025" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="font-size: 0.85rem; font-weight: bold;">Nome da Equipe / Projeto</label>
                            <input type="text" id="win-nome" placeholder="Ex: Equipe Alpha" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label style="font-size: 0.85rem; font-weight: bold;">Descri√ß√£o / Conquista</label>
                        <textarea id="win-texto" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit;" placeholder="Detalhes sobre a vit√≥ria..."></textarea>
                    </div>
                    <div style="margin-top: 15px; display: flex; align-items: center; gap: 15px;">
                        <div style="flex: 1;">
                            <label style="font-size: 0.85rem; font-weight: bold;">Foto da Equipe</label>
                            <input type="file" id="win-foto-input" accept="image/*" style="width: 100%;">
                        </div>
                        <button id="btn-save-winner" class="btn-padrao" onclick="adicionarVencedor()" style="background: var(--azul-principal); color: white; border: none; padding: 10px 30px;">SALVAR VENCEDOR</button>
                    </div>
                </div>

                <h4 style="margin: 30px 0 15px 0; color: var(--azul-escuro); border-bottom: 1px solid #ccc; padding-bottom: 10px;">Vencedores Cadastrados</h4>
                <div id="lista-vencedores-admin" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Cards de vencedores injetados via JS -->
                </div>
            </div>
        </div>
    </div>

    <div id="area-impressao"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"; 
        import { collection, getDocs, deleteDoc, updateDoc, addDoc, doc, query, where, orderBy, limit, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { db, storage, auth, firebaseConfig } from "./config.js";

        // REMOVED: Local Initialization block, using imported instances.
 

        let todosInscritos = [];
        let modoLixeira = false;
        let filtroAtual = 'todos'; // CORRE√á√ÉO: Vari√°vel para controlar o filtro ativo
        let acaoPendente = null;
        let idPendente = null;

        // --- MONITOR DE SESS√ÉO ---
        onAuthStateChanged(auth, (user) => {
            const loginOverlay = document.getElementById('login-overlay');
            const painelConteudo = document.getElementById('painel-conteudo');
            if (user) {
                loginOverlay.style.display = 'none';
                painelConteudo.style.display = 'block';
                document.getElementById('display-nome-user').innerText = user.email;
                carregarDados();
            } else {
                loginOverlay.style.display = 'flex';
                painelConteudo.style.display = 'none';
            }
        });

        // --- LOGIN ---
        window.fazerLogin = async function() {
            const email = document.getElementById('usuario-admin').value.trim();
            const senha = document.getElementById('senha-admin').value.trim();
            const btn = document.getElementById('btn-login');
            const msgErro = document.getElementById('msg-erro');
            if(!email || !senha) return;
            btn.innerText = "Verificando..."; btn.disabled = true; msgErro.style.display = 'none';
            try {
                await signInWithEmailAndPassword(auth, email, senha);
            } catch(error) {
                console.error("Erro Login:", error.code);
                msgErro.innerText = "Erro: Verifique email e senha.";
                msgErro.style.display = 'block';
            } finally {
                btn.innerText = "ENTRAR NO SISTEMA"; btn.disabled = false;
            }
        }
        window.fazerLogout = async function() { await signOut(auth); window.location.reload(); }

        // --- FUN√á√ïES UTILIT√ÅRIAS (LOGS E ALERTS) ---
        window.registrarLog = async function(acao, alvoId) {
            try {
                const user = auth.currentUser;
                const email = user ? user.email : "Sistema";
                await addDoc(collection(db, "logs"), {
                    data: new Date().toLocaleString(),
                    admin: email,
                    acao: acao,
                    alvo_id: alvoId || "N/A",
                    timestamp: Date.now()
                });
            } catch(e) { console.error("Erro ao registrar log:", e); }
        }

        window.mostrarAlerta = function(titulo, msg, tipo='info') {
            const icon = document.getElementById('aviso-icon');
            const h2 = document.getElementById('aviso-titulo');
            const p = document.getElementById('aviso-msg');
            
            h2.innerText = titulo;
            p.innerText = msg;
            
            if(tipo === 'erro') { icon.innerText = 'error'; icon.style.color = 'var(--vermelho-erro)'; }
            else if(tipo === 'sucesso') { icon.innerText = 'check_circle'; icon.style.color = 'var(--verde-sucesso)'; }
            else { icon.innerText = 'info'; icon.style.color = 'var(--azul-principal)'; }

            document.getElementById('modal-aviso').style.display = 'flex';
        }

        // --- CRIAR NOVO ADMIN ---
        window.salvarAdmin = async function() {
            const email = document.getElementById('new-admin-email').value.trim();
            const pass = document.getElementById('new-admin-pass').value.trim();
            const btn = document.getElementById('btn-save-admin');
            const msg = document.getElementById('msg-config');

            if(!email || pass.length < 6) {
                mostrarAlerta("Dados Inv√°lidos", "O e-mail √© obrigat√≥rio e a senha deve ter no m√≠nimo 6 caracteres.", "erro");
                return;
            }

            btn.disabled = true; btn.innerText = "Criando...";
            msg.style.display = 'none';
            
            try {
                const secondaryApp = initializeApp(firebaseConfig, "Secondary");
                const secondaryAuth = getAuth(secondaryApp);
                await createUserWithEmailAndPassword(secondaryAuth, email, pass);
                await signOut(secondaryAuth);
                
                await registrarLog("Criou novo admin", email);
                mostrarAlerta("Sucesso", "Novo administrador criado com sucesso!", "sucesso");
                
                document.getElementById('new-admin-email').value = "";
                document.getElementById('new-admin-pass').value = "";
                fecharModal('modal-config');
            } catch(error) {
                console.error("Erro ao criar admin:", error);
                msg.innerText = "Erro: " + error.code;
                msg.style.color = "var(--vermelho-erro)";
                msg.style.display = "block";
            } finally {
                btn.disabled = false; btn.innerText = "CRIAR ADMINISTRADOR";
            }
        }

        // --- DEMAIS FUN√á√ïES DO PAINEL ---
        window.alternarAba = function(aba) {
            const viewInscritos = document.getElementById('view-inscritos');
            const viewGaleria = document.getElementById('view-galeria');
            const tabInscritos = document.getElementById('tab-inscritos');
            const tabGaleria = document.getElementById('tab-galeria');
            
            // Esconde tudo primeiro (Reset Simples)
            viewInscritos.style.display = 'none'; 
            viewGaleria.style.display = 'none';
            document.getElementById('view-calendario').style.display = 'none'; 
            document.getElementById('view-vencedor').style.display = 'none';
            document.querySelectorAll('.btn-modulo').forEach(b => b.classList.remove('ativo'));

            if(aba === 'inscritos') {
                viewInscritos.style.display = 'block';
                tabInscritos.classList.add('ativo');
            } else if (aba === 'galeria') {
                viewGaleria.style.display = 'block';
                tabGaleria.classList.add('ativo');
                carregarGaleria(); 
            } else if (aba === 'calendario') {
                 document.getElementById('view-calendario').style.display = 'block';
                 document.getElementById('tab-calendario').classList.add('ativo');
                 carregarEventos();
            } else if (aba === 'vencedor') {
                 document.getElementById('view-vencedor').style.display = 'block';
                 document.getElementById('tab-vencedor').classList.add('ativo');
                 carregarVencedorAdmin();
            }
        }
        window.abrirMenuUsuario = function() {
            const menu = document.getElementById('dropdown-menu');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }
        document.addEventListener('click', function(e) {
            const container = document.querySelector('.user-container');
            const menu = document.getElementById('dropdown-menu');
            if (container && !container.contains(e.target) && menu) menu.style.display = 'none';
        });
        window.alternarVisibilidadeSenha = function() {
            const campo = document.getElementById('senha-admin');
            const icone = document.getElementById('icone-olho');
            if (campo.type === "password") { campo.type = "text"; icone.innerText = "visibility_off"; } 
            else { campo.type = "password"; icone.innerText = "visibility"; }
        }

        // --- CARREGAMENTO DE DADOS (COM ORDENA√á√ÉO CORRIGIDA) ---
        window.carregarDados = async function() {
            const grid = document.getElementById('grid-cards'); if(!grid) return;
            document.getElementById('loader').style.display = "block"; grid.innerHTML = ""; todosInscritos = [];
            try {
                const snap = await getDocs(collection(db, "inscricoes"));
                let cT=0, cA=0, cO=0, cM=0;
                snap.forEach(doc => {
                    const d = doc.data(); const item = { id: doc.id, ...d, excluido: d.excluido || false };
                    todosInscritos.push(item);
                    if(!item.excluido) { cT++; if(d.tipo_participacao==="Apresentador") cA++; else if(d.tipo_participacao==="Ouvinte") cO++; else if(d.tipo_participacao==="Monitor") cM++; }
                });
                
                // CORRE√á√ÉO: Ordena√ß√£o por Protocolo (ID) Decrescente - Mais robusto
                todosInscritos.sort((a,b) => {
                     // Protocolo √© string num√©rica (ex: 20251228...), string compare desc funciona perfeitamente
                     return b.id.localeCompare(a.id);
                });

                document.getElementById('total-geral').innerText = cT; document.getElementById('total-apresentadores').innerText = cA;
                document.getElementById('total-ouvintes').innerText = cO; document.getElementById('total-monitores').innerText = cM;
                atualizarVisualizacao();
            } catch(e) { console.error(e); } finally { document.getElementById('loader').style.display = "none"; }
        }

        // --- RENDERIZA√á√ÉO ATUALIZADA (COM M√öLTIPLAS TAGS) ---
        function renderizarCards(lista) {
            const grid = document.getElementById('grid-cards'); 
            grid.innerHTML = "";
            
            if(lista.length === 0) { 
                grid.innerHTML = "<p>Nada encontrado.</p>"; 
                return; 
            }

            lista.forEach(i => {
                let badgesHtml = '';
                if (modoLixeira) {
                    badgesHtml = `<div class='status-badge status-lixeira'>Exclu√≠do</div>`;
                } else {
                    if (!i.confirmado) {
                        badgesHtml += `<div class='status-badge status-pendente'>Pendente</div>`;
                    } else {
                        badgesHtml += `<div class='status-badge status-ok'>Inscrito</div>`;
                    }
                    if (i.certificado_liberado) {
                        badgesHtml += `<div class='status-badge status-ok' style='background:#e0f2fe; color:#0284c7; border-color:#bae6fd;'>Certificado OK</div>`;
                    }
                }

                const statusContainer = `<div style="display:flex; flex-wrap:wrap; gap:5px;">${badgesHtml}</div>`;

                let btns;
                if (modoLixeira) {
                    btns = `<button class='btn-icon btn-restore' onclick="solicitarConfirmacao('restaurar','${i.id}')" title="Restaurar"><span class='material-symbols-rounded'>restore_from_trash</span></button>
                            <button class='btn-icon btn-forever' onclick="solicitarConfirmacao('excluir_permanente','${i.id}')" title="Excluir"><span class='material-symbols-rounded'>delete_forever</span></button>`;
                } else {
                    const btnCert = `<button class='btn-icon' style='background:#f59e0b; color:white;' onclick="alternarCertificado('${i.id}', ${!i.certificado_liberado})" title="Autorizar/Bloquear Certificado"><span class='material-symbols-rounded'>workspace_premium</span></button>`;
                    
                    btns = `<button class='btn-icon btn-view' onclick="verDetalhes('${i.id}')"><span class='material-symbols-rounded'>visibility</span></button>
                            ${(i.tipo_participacao !== 'Ouvinte' && !i.confirmado) ? `<button class='btn-icon btn-confirm' onclick="solicitarConfirmacao('confirmar','${i.id}')"><span class='material-symbols-rounded'>check</span></button>` : ''}
                            ${btnCert} <button class='btn-icon btn-delete' onclick="solicitarConfirmacao('lixeira','${i.id}')"><span class='material-symbols-rounded'>delete</span></button>`;
                }
                
                grid.innerHTML += `<div class='card-pessoa tipo-${i.tipo_participacao} ${modoLixeira ? 'na-lixeira' : ''}'>
                    <div class='card-header'><span class='protocolo'>#${i.protocolo || 'N/A'}</span><span class='card-tag tag-${i.tipo_participacao}'>${i.tipo_participacao}</span></div>
                    <div class='card-body'><h3>${i.nome}</h3><p>${i.cpf}</p></div>
                    <div class='card-footer'>
                        ${statusContainer}
                        <div style='display:flex'>${btns}</div>
                    </div>
                </div>`;
            });
        }

        window.alternarCertificado = async function(id, estado) {
            try {
                await updateDoc(doc(db, "inscricoes", id), { certificado_liberado: estado });
                await registrarLog(estado ? "Liberou certificado" : "Bloqueou certificado", id);
                // Feedback visual r√°pido
                carregarDados();
            } catch(e) {
                mostrarAlerta("Erro", "Falha ao alterar status do certificado: " + e.message, "erro");
            }
        }

        // --- GALERIA E UPLOAD M√öLTIPLO ---
        window.mostrarNomeArquivo = function() {
            const fileInput = document.getElementById('input-foto');
            const nomeDisplay = document.getElementById('nome-arquivo-selecionado');
            if(fileInput.files.length > 0) nomeDisplay.innerText = fileInput.files.length + " arquivo(s) selecionado(s)";
            else nomeDisplay.innerText = "";
        }

        window.fazerUploadFoto = async function() {
            const fileInput = document.getElementById('input-foto');
            const tituloInput = document.getElementById('foto-titulo');
            const btn = document.getElementById('btn-upload');
            const progresso = document.getElementById('progresso-upload');
            
            if (fileInput.files.length === 0) return mostrarAlerta("Aten√ß√£o", "Selecione pelo menos uma imagem!", "erro");
            
            const files = fileInput.files;
            const tituloBase = tituloInput.value;
            btn.disabled = true;
            progresso.style.display = 'block';
            let sucessos = 0;

            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const nomeArquivo = Date.now() + '-' + i + '-' + file.name;
                    const storageRef = ref(storage, 'galeria/' + nomeArquivo);
                    progresso.innerText = `Enviando arquivo ${i + 1} de ${files.length}...`;
                    await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(storageRef);
                    await addDoc(collection(db, "galeria"), { 
                        url: downloadURL, 
                        caminho_storage: 'galeria/' + nomeArquivo, 
                        titulo: files.length > 1 ? `${tituloBase} (${i + 1})` : tituloBase, 
                        data_upload: new Date().toISOString() 
                    });
                    sucessos++;
                }
                await registrarLog("Upload de fotos", `Enviou ${sucessos} fotos (${tituloBase})`);
                mostrarAlerta("Conclu√≠do", `${sucessos} fotos enviadas com sucesso!`, "sucesso"); 
                fileInput.value = ""; tituloInput.value = ""; 
                document.getElementById('nome-arquivo-selecionado').innerText = ""; 
                carregarGaleria();
            } catch (error) { 
                console.error("Erro no upload:", error); mostrarAlerta("Erro", "Erro ao enviar foto: " + error.message, "erro");
            } finally { 
                btn.disabled = false; progresso.style.display = 'none'; progresso.innerText = "Enviando...";
            }
        }

        window.carregarGaleria = async function() {
            const grid = document.getElementById('grid-galeria'); const loader = document.getElementById('loader-galeria');
            grid.innerHTML = ""; loader.style.display = "block";
            try {
                let q = query(collection(db, "galeria"), orderBy("data_upload", "desc"));
                const querySnapshot = await getDocs(q);
                loader.style.display = "none";
                if (querySnapshot.empty) { grid.innerHTML = "<p style='grid-column:1/-1; text-align:center;'>Nenhuma foto na galeria.</p>"; return; }
                querySnapshot.forEach((doc) => {
                    const foto = doc.data();
                    const card = document.createElement('div'); card.className = 'card-foto';
                    card.innerHTML = `<input type="checkbox" class="foto-chk" value="${doc.id}" data-path="${foto.caminho_storage}" onclick="atualizarContador()" style="position: absolute; top: 10px; left: 10px; z-index: 20; width: 22px; height: 22px; cursor: pointer; box-shadow: 0 0 5px rgba(0,0,0,0.3);">
                        <button class="btn-delete-foto" onclick="deletarFoto('${doc.id}', '${foto.caminho_storage}')" title="Excluir Imagem"><span class="material-symbols-rounded">close</span></button>
                        <div class="foto-img-container"><img src="${foto.url}" class="foto-img" alt="Foto" loading="lazy"></div>
                        <div class="card-foto-body">
                            <div style="display:flex; gap:5px;">
                                <input type="text" id="input-legenda-${doc.id}" value="${foto.titulo || ''}" style="flex:1; font-size:0.8rem; border:1px solid #eee; border-radius:4px; padding:2px 5px;">
                                <button onclick="editarLegenda('${doc.id}')" style="background:var(--verde-sucesso); color:white; border:none; border-radius:4px; padding:2px 8px; cursor:pointer;"><span class="material-symbols-rounded" style="font-size:16px;">save</span></button>
                            </div>
                            <div class="card-foto-date">Enviada em: ${foto.data_upload ? new Date(foto.data_upload).toLocaleDateString() : 'Data N/A'}</div>
                        </div>`;
                    grid.appendChild(card);
                });
            } catch (error) { console.error(error); loader.innerText = "Erro ao carregar galeria."; }
        }

        // --- BULK DELETE LOGIC ---
        window.selecionarTodas = function(source) {
            document.querySelectorAll('.foto-chk').forEach(c => c.checked = source.checked);
            atualizarContador();
        }

        window.atualizarContador = function() {
            const count = document.querySelectorAll('.foto-chk:checked').length;
            const btn = document.getElementById('btn-bulk-delete');
            const span = document.getElementById('count-sel');
            const chkAll = document.getElementById('chk-todos');
            
            span.innerText = count;
            btn.style.display = count > 0 ? 'flex' : 'none';
            
            // Atualiza status do "check all" se todos estiverem marcados manualmente
            const total = document.querySelectorAll('.foto-chk').length;
            if(total > 0 && count === total) chkAll.checked = true;
            else if(count < total) chkAll.checked = false;
        }

        window.solicitarExclusaoEmMassa = function() {
            const count = document.querySelectorAll('.foto-chk:checked').length;
            if(count === 0) return;
            acaoPendente = 'bulk_delete';
            document.getElementById('modal-confirmacao').style.display = 'flex';
            document.getElementById('confirm-title').innerText = "Excluir M√∫ltiplos?";
            document.getElementById('confirm-text').innerText = `Voc√™ tem certeza que deseja excluir permanentemente ${count} fotos?`;
            document.getElementById('btn-confirm-action').classList.add('danger');
        }

        // --- NOVA FUN√á√ÉO: EDITAR LEGENDA ---
        window.editarLegenda = async function(docId) {
            const novoTitulo = document.getElementById(`input-legenda-${docId}`).value;
            try {
                await updateDoc(doc(db, "galeria", docId), { titulo: novoTitulo });
                await registrarLog("Editou legenda", docId);
                mostrarAlerta("Salvo", "Legenda atualizada!", "sucesso");
            } catch (error) {
                console.error(error); mostrarAlerta("Erro", "Erro ao salvar.", "erro");
            }
        }

        // --- CALEND√ÅRIO LOGIC ---
        window.salvarEvento = async function() {
            const data = document.getElementById('evt-data').value;
            const desc = document.getElementById('evt-desc').value;
            if(!data || !desc) return mostrarAlerta("Erro", "Preencha data e descri√ß√£o.", "erro");

            try {
                // Use setDoc com ID prefixado para organizar dentro de 'inscricoes'
                // e tipo: 'evento' para filtrar depois.
                const idEvento = "evt_" + Date.now();
                await setDoc(doc(db, "inscricoes", idEvento), {
                    tipo: 'evento', 
                    data: data, 
                    descricao: desc, 
                    timestamp: new Date().toISOString()
                });
                mostrarAlerta("Sucesso", "Evento adicionado!", "sucesso");
                document.getElementById('evt-desc').value = "";
                carregarEventos();
            } catch(e) { console.error(e); mostrarAlerta("Erro", "Falha ao salvar evento: " + e.message, "erro"); }
        }

        window.carregarEventos = async function() {
            const lista = document.getElementById('lista-eventos');
            const total = document.getElementById('total-eventos');
            lista.innerHTML = "Carregando...";
            try {
                // Query filtrando apenas os documentos que s√£o eventos (removido orderBy para evitar erro de indice)
                const q = query(collection(db, "inscricoes"), where("tipo", "==", "evento"));
                const snap = await getDocs(q);
                total.innerText = snap.size;
                lista.innerHTML = "";
                if(snap.empty) { lista.innerHTML = "Nenhum evento."; return; }
                
                let eventos = [];
                snap.forEach(doc => eventos.push({id: doc.id, ...doc.data()}));
                
                // Ordena√ß√£o via JS
                eventos.sort((a,b) => a.data.localeCompare(b.data));

                eventos.forEach(d => {
                    const dataFormatada = new Date(d.data + "T00:00:00").toLocaleDateString('pt-BR');
                    lista.innerHTML += `
                        <div style="background: white; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--azul-principal); box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            <div><strong>${dataFormatada}</strong> - ${d.descricao}</div>
                            <button onclick="deletarEvento('${d.id}')" style="background:none; border:none; color:var(--vermelho-erro); cursor:pointer;"><span class="material-symbols-rounded">delete</span></button>
                        </div>
                    `;
                });

            } catch(e) { lista.innerHTML = "Erro ao carregar."; }
        }

        window.deletarEvento = async function(id) {
            if(!confirm("Excluir evento?")) return;
            // Deleta de inscricoes usando o ID (que j√° √© evt_...)
            await deleteDoc(doc(db, "inscricoes", id));
            carregarEventos();
        }

        // --- VENCEDOR LOGIC ---
        // --- VENCEDORES LOGIC (REFATORADO PARA LISTA POR ANO) ---
        window.adicionarVencedor = async function() {
            const ano = document.getElementById('win-ano').value;
            const nome = document.getElementById('win-nome').value;
            const texto = document.getElementById('win-texto').value;
            const fileInput = document.getElementById('win-foto-input');
            const btn = document.getElementById('btn-save-winner');
            
            if(!ano || !nome || !texto) return mostrarAlerta("Erro", "Preencha Ano, Nome e Descri√ß√£o.", "erro");
            if(fileInput.files.length === 0) return mostrarAlerta("Erro", "Selecione uma foto.", "erro");

            btn.disabled = true; btn.innerText = "Salvando...";
            
            try {
                const file = fileInput.files[0];
                const storageRef = ref(storage, 'vencedores/' + Date.now() + '_' + file.name);
                await uploadBytes(storageRef, file);
                const urlFoto = await getDownloadURL(storageRef);
                
                await addDoc(collection(db, "vencedores"), {
                    ano: parseInt(ano),
                    nome: nome,
                    texto: texto,
                    fotoUrl: urlFoto,
                    criadoEm: new Date().toISOString()
                });
                
                mostrarAlerta("Sucesso", "Vencedor adicionado com sucesso!", "sucesso");
                
                // Reset Form
                document.getElementById('win-ano').value = "";
                document.getElementById('win-nome').value = "";
                document.getElementById('win-texto').value = "";
                document.getElementById('win-foto-input').value = "";
                
                carregarVencedorAdmin(); // Reload list
                
            } catch(e) { console.error(e); mostrarAlerta("Erro", "Erro ao salvar: " + e.message, "erro"); }
            finally { btn.disabled = false; btn.innerText = "SALVAR VENCEDOR"; }
        }

        window.carregarVencedorAdmin = async function() {
            const container = document.getElementById('lista-vencedores-admin');
            container.innerHTML = "Carregando...";
            try {
                const q = query(collection(db, "vencedores"), orderBy("ano", "desc"));
                const snap = await getDocs(q);
                
                container.innerHTML = "";
                if(snap.empty) {
                    container.innerHTML = "<p>Nenhum vencedor cadastrado.</p>";
                    return;
                }

                snap.forEach(doc => {
                    const d = doc.data();
                    container.innerHTML += `
                        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-top: 5px solid var(--amarelo-alerta); position: relative;">
                            <div style="position: absolute; top: 15px; right: 15px;">
                                <button onclick="excluirVencedorId('${doc.id}')" style="background: #fee2e2; color: var(--vermelho-erro); border: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; font-weight: bold;">Excluir</button>
                            </div>
                            <h2 style="color: var(--azul-principal); font-size: 2rem; margin-bottom: 5px;">${d.ano}</h2>
                            <h4 style="margin-bottom: 10px; color: #555;">${d.nome}</h4>
                            <img src="${d.fotoUrl}" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;">
                            <p style="font-size: 0.9rem; color: #666;">${d.texto}</p>
                        </div>
                    `;
                });

            } catch(e) { console.log(e); container.innerHTML = "Erro ao carregar lista."; }
        }

        window.excluirVencedorId = async function(id) {
            if(!confirm("Excluir este registro de vencedor?")) return;
            try {
                await deleteDoc(doc(db, "vencedores", id));
                await registrarLog("Excluiu Vencedor", id);
                carregarVencedorAdmin();
            } catch(e) { console.error(e); }
        }

        window.deletarFoto = async function(docId, caminhoStorage) {
            if(!confirm("Tem certeza que deseja excluir esta foto permanentemente?")) return;
            try {
                if(caminhoStorage) await deleteObject(ref(storage, caminhoStorage)).catch(e => console.log(e));
                await deleteDoc(doc(db, "galeria", docId)); 
                await registrarLog("Excluiu foto", docId);
                carregarGaleria();
            } catch(error) { console.error(error); mostrarAlerta("Erro", "Erro ao excluir imagem.", "erro"); }
        }

        // --- LOGS E MODAIS ---
        window.abrirModalLogs = async function() {
            document.getElementById('modal-logs').style.display = 'flex';
            const tbody = document.getElementById('tbody-logs'); tbody.innerHTML = '';
            try {
                // CORRE√á√ÉO: Limitar aos 10 √∫ltimos registros
                const q = query(collection(db, 'logs'), orderBy('timestamp', 'desc'), limit(10));
                const snap = await getDocs(q);
                snap.forEach(d => {
                    const l = d.data();
                    tbody.innerHTML += `<tr><td>${l.data}</td><td>${l.admin}</td><td>${l.acao}</td><td>${l.alvo_id}</td></tr>`;
                });
            } catch(e){ tbody.innerHTML = "<tr><td colspan='4'>Erro ao carregar logs</td></tr>"; }
        }
        window.abrirModalConfig = function() { document.getElementById('modal-config').style.display = 'flex'; }
        window.solicitarConfirmacao = function(tipo, id) {
            idPendente = id; acaoPendente = tipo;
            const btn = document.getElementById('btn-confirm-action'); const txt = document.getElementById('confirm-title');
            document.getElementById('modal-confirmacao').style.display = 'flex';
            if(tipo === 'lixeira' || tipo === 'excluir_permanente') { btn.classList.add('danger'); txt.innerText = "Tem certeza?"; }
            else { btn.classList.remove('danger'); txt.innerText = "Confirmar?"; }
        }
        window.executarAcaoConfirmada = async function() {
            fecharModal('modal-confirmacao');
            try {
                if(acaoPendente === 'confirmar') {
                     await updateDoc(doc(db,"inscricoes",idPendente),{confirmado:true});
                     await registrarLog("Confirmou Inscri√ß√£o", idPendente);
                }
                else if(acaoPendente === 'lixeira') {
                     await updateDoc(doc(db,"inscricoes",idPendente),{excluido:true});
                     await registrarLog("Moveu para lixeira", idPendente);
                }
                else if(acaoPendente === 'restaurar') {
                     await updateDoc(doc(db,"inscricoes",idPendente),{excluido:false});
                     await registrarLog("Restaurou da lixeira", idPendente);
                }
                else if(acaoPendente === 'excluir_permanente') {
                     await deleteDoc(doc(db,"inscricoes",idPendente));
                     await registrarLog("Excluiu permanentemente", idPendente);
                }
                else if(acaoPendente === 'bulk_delete') {
                    const chks = document.querySelectorAll('.foto-chk:checked');
                    let deletados = 0;
                    const btn = document.getElementById('btn-confirm-action');
                    btn.innerText = "Excluindo...";
                    
                    for (const chk of chks) {
                        const id = chk.value;
                        const path = chk.getAttribute('data-path');
                        // Tenta deletar sem parar em erro individual
                        try {
                            if(path && path !== 'undefined') await deleteObject(ref(storage, path)).catch(e => console.log('Erro storage:', e));
                            await deleteDoc(doc(db, "galeria", id));
                            deletados++;
                        } catch(e) { console.error('Erro delete:', e); }
                    }
                    await registrarLog("Exclus√£o Dispon√≠vel", `Excluiu ${deletados} fotos em massa`);
                    mostrarAlerta("Conclu√≠do", `${deletados} fotos foram exclu√≠das.`, "sucesso");
                    carregarGaleria();
                    document.getElementById('chk-todos').checked = false;
                    document.getElementById('btn-bulk-delete').style.display = 'none';
                    btn.innerText = "Sim, Confirmar"; // Reset
                }
                carregarDados();
            } catch(e) { mostrarAlerta("Erro", "Erro na a√ß√£o: " + e.message, "erro"); }
        }
        window.verDetalhes = function(id) {
            const i = todosInscritos.find(x => x.id === id);
            document.getElementById('modal-body').innerHTML = `<h2>${i.nome}</h2><p><strong>Email:</strong> ${i.email || 'N√£o informado'}</p><p><strong>CPF:</strong> ${i.cpf}</p><p><strong>Escola:</strong> ${i.onde_estuda}</p>`;
            document.getElementById('modal-detalhes').style.display = 'flex';
        }
        window.fecharModal = (id) => document.getElementById(id).style.display = 'none';
        window.alternarModoLixeira = function() { modoLixeira = !modoLixeira; atualizarVisualizacao(); }
        window.filtrar = (tipo, btn) => { 
            document.querySelectorAll('.btn-filtro').forEach(x => x.classList.remove('ativo')); 
            btn.classList.add('ativo'); 
            filtroAtual = tipo; atualizarVisualizacao(); 
        }
        window.atualizarVisualizacao = function() { 
            let listaFiltrada = todosInscritos.filter(i => modoLixeira ? i.excluido : !i.excluido);
            if (!modoLixeira) {
                if (filtroAtual === 'confirmados') listaFiltrada = listaFiltrada.filter(i => i.confirmado);
                else if (filtroAtual !== 'todos') listaFiltrada = listaFiltrada.filter(i => i.tipo_participacao === filtroAtual);
            }
            renderizarCards(listaFiltrada); 
            const tL = document.getElementById('titulo-grid'); if(tL) tL.style.display = modoLixeira ? 'block' : 'none';
        }
        window.abrirModalRelatorios = () => document.getElementById('modal-relatorios').style.display = 'flex';
        window.gerarRelatorio = function(tipo) {
            const area = document.getElementById('area-impressao');
            let listaParaImprimir = todosInscritos.filter(i => !i.excluido);
            let tituloRelatorio = "Lista Geral de Presen√ßa";
            
            // NOVO: Filtro solicitado para lista de presen√ßa mostrar APENAS apresentadores
            if (tipo === 'lista_presenca') {
                listaParaImprimir = listaParaImprimir.filter(i => i.tipo_participacao === 'Apresentador');
                tituloRelatorio = "Lista de Presen√ßa - Apresentadores";
            }
            // Manter l√≥gica existente para outros tipos se houver, ou redund√¢ncia
            else if (tipo === 'lista_apresentadores') {
                listaParaImprimir = listaParaImprimir.filter(i => i.tipo_participacao === 'Apresentador');
                tituloRelatorio = "Relat√≥rio de Apresentadores de Projetos";
            }
            let html = `<div class="print-header"><img src="ufal.webp"> <img src="https://ufal.br/transparencia/imagens/logo-ufal.png" style="height:80px"> <img src="brasaoteotoniovilela.png"> </div>
                <div style="text-align:center; margin-bottom:20px;"><h2>${tituloRelatorio}</h2><p>Feira da Matem√°tica - PIBID UFAL | Data: ${new Date().toLocaleDateString()}</p></div>
                <table class="relatorio-oficial"><thead><tr><th>Nome do Participante</th><th>CPF</th><th>Escola de Origem</th><th>Projeto / Fun√ß√£o</th><th style="width:150px">Assinatura</th></tr></thead><tbody>`;
            listaParaImprimir.forEach(i => {
                html += `<tr><td>${i.nome}</td><td>${i.cpf}</td><td>${i.onde_estuda || '---'}</td><td>${i.nome_projeto || i.tipo_participacao}</td><td></td></tr>`;
            });
            html += `</tbody></table><p style="font-size:9px; margin-top:20px; font-style:italic;">Documento emitido em ${new Date().toLocaleString()} - Sistema de Gest√£o PIBID</p>`;
            area.innerHTML = html;
            fecharModal('modal-relatorios');
            setTimeout(() => { window.print(); }, 500);
        };
    </script>
</body>
</html>
<!-- root@J/A:~# -->
